# DOCTYPE和浏览器渲染模式

## DOCTYPE作用

DOCTYPE标签是一种标准通用标记语言的文档类型声明。

`<!DOCTYPE>`声明位于HTML文档最前面的位置，处于`<html>`标签之前。

它的目的是要告诉标准通用标记语言解析器，它应该使用什么样的文档类型定义（DTD）来解析文档。

## 浏览器渲染引擎

渲染引擎主要包含两部分，一部分负责 HTML、CSS 代码的解析，另一部分负责脚本代码解析，这两部分合起来就可以绘制出完整的页面。

> 从你在浏览器输入一个网址到网页内容完全被展示的这段时间内，都发生了什么事情？
>
> 总体来说共分成一下几个过程:
>
> - **URL输入** (浏览器在接收到这个指令时，会开启一个单独的线程来处理这个指令，首先要判断用户输入的是否为合法或合理的 URL 地址，是否为 HTTP 协议请求，如果是那就进入下一步)
> - **DNS解析** (浏览器的浏览器引擎将对此 URL 进行分析，如果存在缓存「cache-control」且未过期，则会从本地缓存提取文件（From Memory Cache，200返回码），如果缓存「cache-control」不存在或过期，浏览器将发起远程请求)
> - **TCP连接** (通过 DNS 解析域名获取该网站地址对应的 IP 地址，连同浏览器的 Cookie、 userAgent 等信息向此 IP 发出 GET 请求)
> - **发送HTTP请求** (经典的「三次握手」，HTTP 协议会话，浏览器客户端向 Web 服务器发送报文，进行通讯和数据传输)
> - **服务器处理请求、服务器响应请求** (服务器处理请求并返回响应报文，如果浏览器访问过该页面，缓存上有对应资源，与服务器最后修改记录对比，一致则返回 304，否则返回 200 和对应的内容)
> - **浏览器解析渲染页面** (浏览器的渲染引擎在拿到 HTML 文件后，便开始解析构建 DOM 树，并根据 HTML 中的标记请求下载指定的 MIME 类型文件（如 CSS、 JavaScript 脚本等），同时使用&设置缓存等内容。渲染引擎根据 CSS 样式规则将 DOM 树扩充为渲染树，然后进行重排、重绘。如果含有 JS 文件将会执行，进行 Dom 操作、缓存读存、事件绑定等操作。最终页面将被展示在浏览器上)
> - 连接结束



## 浏览器解析HTML方式

 浏览器对HTML文档有三种解析方式:

- 标准模式（非怪异模式）
- 兼容模式（怪异模式）
- 近乎标准模式（部分怪异模式）

HTML5提供的`<DOCTYPE html>`是标准模式，向后兼容的, 等同于开启了标准模式，那么浏览器就得老老实实的按照W3C的 标准解析渲染页面，这样一来，你的页面在所有的浏览器里显示的就都是一个样子了。

## 参考资料

* [浏览器渲染引擎](<https://juejin.im/post/5ac45882518825558723c4fd>)
* [怪异模式（Quirks Mode）对 HTML 页面的影响](<https://www.ibm.com/developerworks/cn/web/1310_shatao_quirks/>)